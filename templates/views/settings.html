{{template "header.html" .}}
<body class="bg-dark text-light">
<div class="container-fluid vh-100 master-container">
    <div class="row h-100 justify-content-center">
        <!-- Nav Panel -->
        {{ template "nav.html" . }}

        <!-- Modals -->
        {{ template "modals.html" . }}

        {{ if .IsSelf }}
            <!-- Main Content -->
            <div id="content-body" onscroll="updateScrollback();" class="h-100">
            <div class="p-2 w-100 no-h-scroll">
                <h2 class="mb-3">Bio</h2>
                <form method="POST" enctype="multipart/form-data" class="p-2">
                    <input type="hidden" name="user_action" value="update_description" autofocus>
                    <input type="hidden" name="page" value="settings">
                    <input type="hidden" name="user_id" value="{{ .user.ID }}">

                    <!-- Display name -->
                    <div class="form-group cool-input">
                        <label for="displayName">Display name</label>
                        <input type="text" name="display_name" class="form-control" id="displayName" oninput="validateField(this, 'display_name', false)"
                               placeholder="Bob 'Snake' Plissken" value="{{ .user.Display }}" required aria-required>
                    </div>

                    <!-- Description -->
                    <div class="form-group cool-input">
                        <label for="description">About me</label>
                        <textarea type="text" name="description" class="bg-dark form-control text-light" id="description" placeholder="I'm too tired, maybe later."
                                  required aria-required oninput="validateDescription()">{{ .user.Description }}</textarea>
                    </div>

                    <!-- Location -->
                    <div class="form-group cool-input">
                        <label for="location">Location <span class="text-muted">(optional)</span></label>
                        <input type="text" name="location" class="form-control" id="location" oninput="validateField(this, 'location', false)"
                               placeholder="Planet Earth, The Solar System" value="">
                    </div>

                    <!-- Website -->
                    <div class="form-group cool-input">
                        <label for="website">Website <span class="text-muted">(optional)</span></label>
                        <input type="text" name="website" class="form-control" id="website" oninput="validateField(this, 'website', false)"
                               placeholder="https://onlycrabs.com/bigred" value="{{ .user.Website }}">
                    </div>

                    <!-- Bio -->
                    <label>
                        Fun facts
                        <span class="text-muted">
                    (optional)
                </span>
                        <br>
                        <small class="text-muted">
                            Tell people about yourself!
                        </small>
                    </label>
                    <div class="mb-2 input-group cool-input">
                        <div class="input-group-prepend">
                            <label class="input-group-text" for="bio.age">Age</label>
                        </div>
                        <input type="text" name="bio.age" id="bio.age" class="bg-dark form-control text-light" placeholder="e.g. 42" oninput="validateField(this, 'age', true)">
                    </div>
                    <div class="mb-2 input-group cool-input">
                        <div class="input-group-prepend">
                            <label class="input-group-text" for="bio.pronouns">Pronouns</label>
                        </div>
                        <input type="text" name="bio.pronouns" id="bio.pronouns" class="bg-dark form-control text-light" placeholder="e.g. they/them" oninput="validateField(this, 'pronouns', true)">
                    </div>
                    <div class="mb-2 input-group cool-input">
                        <div class="input-group-prepend">
                            <label class="input-group-text" for="bio.quote">Quote</label>
                        </div>
                        <input type="text" name="bio.quote" id="bio.quote" class="bg-dark form-control text-light" placeholder="e.g. The world is your lobster." oninput="validateField(this, 'quote', true)">
                    </div>
                    <div class="mb-2 input-group cool-input">
                        <div class="input-group-prepend">
                            <label class="input-group-text" for="bio.jam">My jam</label>
                        </div>
                        <input type="text" name="bio.jam" id="bio.jam" class="bg-dark form-control text-light" placeholder="e.g. Frank Sinatra - My Way" oninput="validateField(this, 'jam', true)">
                    </div>
                    <div class="mb-2 input-group cool-input">
                        <div class="input-group-prepend">
                            <label class="input-group-text" for="bio.obsession">Latest obsession</label>
                        </div>
                        <input type="text" name="bio.obsession" id="bio.obsession" class="bg-dark form-control text-light" placeholder="e.g. playing with my Tamagotchi" oninput="validateField(this, 'obsession', true)">
                    </div>
                    <div class="mb-2 input-group cool-input">
                        <div class="input-group-prepend">
                            <label class="input-group-text" for="bio.remember">Remember when</label>
                        </div>
                        <input type="text" name="bio.remember" id="bio.remember" class="bg-dark form-control text-light" placeholder="e.g. profile pictures were square?" oninput="validateField(this, 'remember', true)">
                    </div>
                    <div class="input-group cool-input">
                        <div class="input-group-prepend">
                            <label class="input-group-text" for="bio.emoji">Favorite emoji</label>
                        </div>
                        <input type="text" name="bio.emoji" id="bio.emoji" class="bg-dark form-control text-light" placeholder="e.g. ðŸŒµ or ;)" oninput="validateField(this, 'emoji', true)">
                    </div>

                    <!-- Social links -->
                    <label class="mt-3">
                        Social links
                        <span class="text-muted">
                    (optional)
                </span>
                        <br>
                        <small class="text-muted">
                            Put your eggs in all the baskets!
                        </small>
                    </label>
                    <div class="mb-2 input-group cool-input">
                        <div class="input-group-prepend">
                            <label class="input-group-text" for="bio.social-discord">Discord</label>
                        </div>
                        <input type="text" name="bio.social-discord" id="bio.social-discord" class="bg-dark form-control text-light" placeholder="username" oninput="validateField(this, 'social', true)"
                               data-regex="">
                    </div>
                    <div class="mb-2 input-group cool-input">
                        <div class="input-group-prepend">
                            <label class="input-group-text" for="bio.social-github">GitHub</label>
                        </div>
                        <input type="text" name="bio.social-github" id="bio.social-github" class="bg-dark form-control text-light" placeholder="username" oninput="validateField(this, 'social', true)"
                               data-regex="">
                    </div>
                    <div class="mb-2 input-group cool-input">
                        <div class="input-group-prepend">
                            <label class="input-group-text" for="bio.social-spacehey">SpaceHey</label>
                        </div>
                        <input type="text" name="bio.social-spacehey" id="bio.social-spacehey" class="bg-dark form-control text-light" placeholder="profile link" oninput="validateField(this, 'social', true)"
                               data-regex="">
                    </div>
                    <div class="mb-2 input-group cool-input">
                        <div class="input-group-prepend">
                            <label class="input-group-text" for="bio.social-spotify">Spotify</label>
                        </div>
                        <input type="text" name="bio.social-spotify" id="bio.social-spotify" class="bg-dark form-control text-light" placeholder="profile link" oninput="validateField(this, 'social', true)"
                               data-regex="">
                    </div>
                    <div class="mb-2 input-group cool-input">
                        <div class="input-group-prepend">
                            <label class="input-group-text" for="bio.social-twitch">Twitch</label>
                        </div>
                        <input type="text" name="bio.social-twitch" id="bio.social-twitch" class="bg-dark form-control text-light" placeholder="channel link" oninput="validateField(this, 'social', true)"
                               data-regex="">
                    </div>
                    <div class="mb-2 input-group cool-input">
                        <div class="input-group-prepend">
                            <label class="input-group-text" for="bio.social-youtube">YouTube</label>
                        </div>
                        <input type="text" name="bio.social-youtube" id="bio.social-youtube" class="bg-dark form-control text-light" placeholder="channel link" oninput="validateField(this, 'social', true)"
                               data-regex="">
                    </div>
                    <div class="mb-2 input-group cool-input">
                        <div class="input-group-prepend">
                            <label class="input-group-text" for="bio.social-steam">Steam</label>
                        </div>
                        <input type="text" name="bio.social-steam" id="bio.social-steam" class="bg-dark form-control text-light" placeholder="Steam ID" oninput="validateField(this, 'social', true)"
                               data-regex="">
                    </div>
                    <div class="mb-2 input-group cool-input">
                        <div class="input-group-prepend">
                            <label class="input-group-text" for="bio.social-xbox">Xbox Live</label>
                        </div>
                        <input type="text" name="bio.social-xbox" id="bio.social-xbox" class="bg-dark form-control text-light" placeholder="gamertag" oninput="validateField(this, 'social', true)"
                               data-regex="">
                    </div>
                    <div class="mb-2 input-group cool-input">
                        <div class="input-group-prepend">
                            <label class="input-group-text" for="bio.social-psn">PlayStation Network</label>
                        </div>
                        <input type="text" name="bio.social-psn" id="bio.social-psn" class="bg-dark form-control text-light" placeholder="PSN ID" oninput="validateField(this, 'social', true)"
                               data-regex="">
                    </div>
                    <div class="mb-2 input-group cool-input">
                        <div class="input-group-prepend">
                            <label class="input-group-text" for="bio.social-nso">Nintendo Switch Online</label>
                        </div>
                        <input type="text" name="bio.social-nso" id="bio.social-nso" class="bg-dark form-control text-light" placeholder="friend code" oninput="validateField(this, 'social', true)"
                               data-regex="">
                    </div>

                    <!-- Submit button -->
                    <button id="bio-save" class="btn btn-primary rounded-pill mt-3 float-right" type="submit"><strong>Save</strong></button>
                    <div class="clearfix"></div>
                </form>

                <!-- Section border -->
                <hr class="border-dark mb-3 mt-4">

                <h2 class="mb-3">Account</h2>
                <form method="POST" class="p-2">
                    <input type="hidden" name="user_action" value="update_account">

                    <!-- Email address -->
                    <div class="form-group cool-input">
                        <label for="exampleInputEmail1">Email address</label>
                        <input type="email" name="email" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp"
                               placeholder="Please enter an email address" value="{{ .user.Email }}" required aria-required>
                    </div>

                    <!-- Username -->
                    <div class="form-group cool-input">
                        <label for="inlineFormInputGroup">Username</label>
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <div class="input-group-text">@</div>
                            </div>
                            <input name="username" type="text" class="form-control" id="inlineFormInputGroup" placeholder="crablover2000"
                                   data-regex=""
                                   oninput="validateField(this, 'username', false)"
                                   value="{{ .user.Display }}" required aria-required>
                        </div>
                    </div>

                    <!-- Submit button -->
                    <button class="btn btn-primary rounded-pill mt-3 float-right" type="submit"><strong>Save</strong></button>
                    <div class="clearfix"></div>
                </form>

                <form method="POST" class="p-2">
                    <input type="hidden" name="user_action" value="change_password">
                    <h3 class="mb-3">Change password</h3>

                    <!-- Old Pass -->
                    <div class="form-group cool-input">
                        <label for="old-password">Current password</label>
                        <input type="password" name="old-password" class="form-control" id="old-password" required aria-required>
                    </div>

                    <!-- New Pass -->
                    <div class="form-group cool-input">
                        <label for="new-password">New password</label>
                        <input type="password" name="new-password" class="form-control" id="new-password" autocomplete="new-password" required aria-required>
                    </div>

                    <!-- Confirm pass -->
                    <div class="form-group cool-input">
                        <label for="confirm-new-password">Confirm new password</label>
                        <input type="password" name="confirm-password" class="form-control" id="confirm-new-password" autocomplete="new-password" required aria-required>
                    </div>

                    <!-- Submit button -->
                    <button class="btn btn-primary rounded-pill mt-3 float-right" type="submit"><strong>Change Password</strong></button>
                    <div class="clearfix"></div>
                </form>

                <!-- Section border -->
                <hr class="border-dark mb-3 mt-4">

                <h2 class="mb-3">Content Filtering</h2>
                <form method="POST" class="p-2">
                    <input type="hidden" name="user_action" value="update_content_filters">
                    <!-- Muted Words -->
                    <div class="form-group cool-input">
                        <label for="description">Muted words (comma separated)</label>
                        <textarea type="text" name="muted_words"
                                  class="bg-dark form-control text-light" id="muted-words"
                                  placeholder="emacs, lua, twitter"
                        ></textarea>
                    </div>

                    <!-- NSFW Toggle -->
                    <div class="form-group cool-input mb-2">
                        <script>
                            function confirmAge(elem) {
                                if (elem.checked) {
                                    elem.checked = confirm('Are you 18 years or older?');
                                }
                                elem.value = elem.checked;
                            }
                        </script>
                        <div class="custom-control custom-switch">
                            <input onchange="return confirmAge(this)" type="checkbox" class="custom-control-input" id="toggle-nsfw-mode"
                                   name="nsfw_mode"
                            value=""
                            >
                            <label class="custom-control-label" for="toggle-nsfw-mode">Display NSFW Content</label>
                        </div>
                    </div>

                    <!-- Blocked users -->
                    <div class="mb-2">
                        <a href="javascript:void(0);" class="text-muted" onclick="toggleModal('#blocked_modal');">
                            Click here to see a list of users you've blocked.
                        </a>
                    </div>

                    <!-- Submit button -->
                    <button class="btn btn-primary rounded-pill mt-3 float-right" type="submit">
                        <strong>
                            Save
                        </strong>
                    </button>

                    <div class="clearfix"></div>
                </form>

                <!-- Section border -->
                <hr class="border-dark mb-3 mt-4">

                <!-- Section border -->
                <hr class="border-dark mb-3 mt-4">

                <h2 class="mb-3">Danger Zone</h2>
                <form class="p-2">
                    <p>
                        Looking to delete your account? You can
                        <a href="/delete-account">
                            do that here.
                        </a>
                    </p>
                    <div class="clearfix"></div>
                </form>

                <!-- Section border -->
                <hr class="border-dark mb-3 mt-4">

                <h2 class="mb-3">
            <span class="glitch-wrapper">
                <span class="glitch" data-text="[REDACTED]">
                    [REDACTED] ZONE
                </span>
            </span>
                </h2>
                <form method="POST" class="p-2" onchange="updateStylePreferences(this);">
                    <input type="hidden" name="user_action" value="style_settings">

                    <p>Exercise EXTREME caution.<p>

                    <!-- Light Mode -->
                    <div class="form-group cool-input mb-2">
                        <div class="custom-control custom-switch">
                            <input type="checkbox" class="custom-control-input" id="toggle-light-mode"
                                   name="light_mode">
                            <label class="custom-control-label" for="toggle-light-mode">Light Mode</label>
                        </div>
                    </div>

                    <!-- Dyslexic Mode -->
                    <div class="form-group cool-input mb-2">
                        <div class="custom-control custom-switch">
                            <input type="checkbox" class="custom-control-input" id="toggle-dyslexic-mode"
                                   name="dyslexic_mode">
                            <label class="custom-control-label" for="toggle-dyslexic-mode">Dyslexic Mode</label>
                        </div>
                    </div>

                    <!-- Comic Sans Mode -->
                    <div class="form-group cool-input mb-2">
                        <div class="custom-control custom-switch">
                            <input type="checkbox" class="custom-control-input" id="toggle-comicsans-mode"
                                   name="comicsans_mode">
                            <label class="custom-control-label" for="toggle-comicsans-mode">Comic Sans Mode</label>
                        </div>
                    </div>
                </form>

                <!-- Spacer -->
                <div class="d-inline-block w-100 py-5 my-5 text-muted text-molt text-center"></div>
            </div>


            <!-- Spacer -->
            <div class="d-inline-block w-100 p-5 my-5 text-muted text-molt text-center"></div>

            <!-- This is where dynamic toasts will show up -->
            <div id="toaster-coaster">
            </div>

            <script async>
                attachCharacterCounters();
            </script>
            <script>
                // Stop autofocus
                document.querySelector("input[name='lastfm']").blur();
                document.body.scrollTop = 0; // For Safari
                document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera

                var limits = 160;
                limits = JSON.parse(limits);

                function validateDescription() {
                    const input = $('#description');
                    const content = input.val();
                    if (content.length >= limits['description'])
                        input.val(content.substring(0, limits['description']));
                }
            </script>
            <!-- Ctrl-Enter form submit -->
            <script>
                var currentForm = null;
                $(document).keypress(
                    function(event) {
                        if (event.keyCode === 13 && event.ctrlKey) {
                            if (currentForm) {
                                event.preventDefault();
                                if ($(currentForm).find('button[type=submit]').attr('disabled') == null) {
                                    currentForm.submit()
                                }
                            }
                        }
                    }
                );

                $('.draft-modal').on('shown.bs.modal', function() {
                    $(this).find('textarea').focus();
                });

                // IT WAS THAT EASY THE WHOLE TIME???
                const target = document.getElementById('content-body');
                $('.master-container div.row.h-100').on('wheel', function(event) {
                    if (event.target.closest('#content-body') == null) {
                        target.scrollTop += event.originalEvent.deltaY;
                    }
                });
            </script>
        </div>
        {{ end }}

        {{ if not .IsSelf }}
            <h1>You're not supposed to be here...</h1>
        {{ end }}

    <!-- Additional Panel -->
    {{ template "search.html" . }}
</div>

</body>
</html>


